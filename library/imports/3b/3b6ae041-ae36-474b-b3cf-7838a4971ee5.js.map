{"version":3,"sources":["assets\\scripts\\arrow\\ArrowPlayer.js"],"names":["cc","Class","Component","properties","bulletPrefab","type","Prefab","skillBulletPrefab","scene","Node","speed","dir","Vec2","RIGHT","faceDir","idleAnim","runAnim","attackAnim","skillAnim","attackAudio","AudioClip","vDown","g","moveAble","skill","audioEngine","playEffect","playAnimation","animationBlock","attack","nextAttackAnim","run","running","idle","die","anim","node","getComponent","Animation","stop","game","onGameFailed","setDir","normalize","x","runAction","flipX","ctx","getGraphics","clear","i","start","v2","y","moveTo","lineTo","stroke","onLoad","bloodLeft","blood","onStart","getChildByName","Graphics","update","dt","mag","sceneDir","xb","width","animation","repeat","animState","play","wrapMode","WrapMode","Normal","Loop","repeatCount","Infinity","skillBullet","newBullet","instantiate","addChild","pos","getParent","convertToWorldSpaceAR","position","convertToNodeSpaceAR","owner","shootBullet","bullet","bulletPos","negSelf","onAttackFinish","onCollisionEnter","other","self","group","selfPos","otherPos","add","offset","size","onCollisionExit"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        bulletPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        skillBulletPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        scene: {\n            default: null,\n            type: cc.Node\n        },\n        speed: 0,\n        dir: cc.Vec2.RIGHT,\n        faceDir: 1,\n\n        idleAnim: '',\n        runAnim: '',\n        attackAnim: '',\n        skillAnim: '',\n        attackAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n        vDown: 0,\n        g: 1500,\n        moveAble: true,\n    },\n\n    skill() {\n        if (this.skillAnim) {\n            cc.audioEngine.playEffect(this.attackAudio, false);\n            this.playAnimation(this.skillAnim, false);\n            this.animationBlock = true;\n        } else {\n            this.attack();\n        }\n    },\n\n    attack () {\n        if (this.animationBlock) {\n            return;\n        }\n        if (!this.nextAttackAnim) {\n            this.nextAttackAnim = this.attackAnim;\n        }\n        this.animationBlock = true;\n        cc.audioEngine.playEffect(this.attackAudio, false);\n        this.playAnimation(this.nextAttackAnim, false);\n    },\n\n    run () {\n        if (!this.animationBlock && this.runAnim) {\n            this.playAnimation(this.runAnim, true)\n        }\n        this.running = true;\n    },\n\n    idle () {\n        if (!this.animationBlock && this.idleAnim) {\n            this.playAnimation(this.idleAnim, true);\n        }\n        this.running = false;\n    },\n\n    die () {\n        var anim = this.node.getComponent(cc.Animation);\n        anim.stop();\n        this.game.onGameFailed();\n    },\n\n    setDir(dir) {\n        this.dir = dir.normalize();\n        if (this.dir.x > 0) {\n            this.faceDir = -1;\n        } else if (this.dir.x < 0) {\n            this.faceDir = 1;\n        }\n        this.node.runAction(cc.flipX(this.faceDir < 0));\n\n        var ctx = this.getGraphics();\n        ctx.clear();\n        for (var i = 5; i < 30; i++) {\n            var start = cc.v2(-this.faceDir * i * 20 * this.dir.x, -i * 20 * this.dir.y + 20)\n            ctx.moveTo(start.x, start.y);\n            ctx.lineTo(start.x - this.faceDir * 10 * this.dir.x, start.y - 10 * this.dir.y);\n        }\n        ctx.stroke();\n    },\n\n    onLoad () {\n        this.bloodLeft = this.blood;\n        this.animationBlock = false;\n        this.setDir(cc.v2(0, 0));\n        this.idle();\n        this.getComponent(\"LivingObject\").die = this.die;\n        this.node.x = -300;\n    },\n\n    onStart () {\n    },\n\n    getGraphics() {\n        if (!this.ctx) {\n            this.ctx = this.node.getChildByName(\"graphics\").getComponent(cc.Graphics);\n        }\n        return this.ctx;\n    },\n\n    update (dt) {\n        this.node.y += this.vDown * dt;\n        this.vDown -= this.g * dt;\n        if (this.dir.mag() === 0 || !this.moveAble) {\n            if (this.running) {\n                this.idle();\n            }\n            return;\n        }\n        if (!this.running) {\n            this.run();\n        }\n        var sceneDir = -this.faceDir;\n        var xb = this.scene.width / 2;\n        if ((this.node.x < -10 && this.faceDir > 0) || (this.node.x > 10 && this.faceDir < 0)) {\n            this.node.x += this.speed * this.faceDir * dt;\n            return;\n        }\n        if ((this.scene.x < xb && sceneDir > 0) || (this.scene.x > -xb && sceneDir < 0)) {\n            this.scene.x += this.speed * sceneDir * dt;\n            return;\n        }\n        if ((this.node.x < 450 && this.faceDir > 0) || (this.node.x > -450 && this.faceDir < 0)) {\n            this.node.x += this.speed * this.faceDir * dt;\n            return;\n        }\n    },\n\n    playAnimation(animation, repeat) {\n        var anim = this.node.getComponent(cc.Animation);\n        anim.stop();\n        var animState = anim.play(animation);\n        if (repeat) {\n            animState.wrapMode = cc.WrapMode.Normal;\n            animState.wrapMode = cc.WrapMode.Loop;\n            animState.repeatCount = Infinity;\n        }\n    },\n\n    skillBullet() {\n        var newBullet = cc.instantiate(this.skillBulletPrefab);\n        this.scene.addChild(newBullet, 1);\n        var pos = this.node.getParent().convertToWorldSpaceAR(this.node.position);\n        pos = this.scene.convertToNodeSpaceAR(pos);\n        newBullet.position = pos;\n        newBullet.getComponent('Bullet').dir = cc.v2(this.faceDir, 0);\n        newBullet.getComponent('Bullet').owner = this;\n    },\n\n    shootBullet (bullet, bulletPos) {\n        if (!bullet) {\n            bullet = this.bulletPrefab;\n        }\n        var newBullet = cc.instantiate(bullet);\n        this.scene.addChild(newBullet, 1);\n        var pos = this.node.getParent().convertToWorldSpaceAR(this.node.position);\n        pos = this.scene.convertToNodeSpaceAR(pos);\n        if (!bulletPos || bulletPos === \"front\") {\n            pos.y += 20;\n            //pos.x = pos.x + this.faceDir * this.node.width / 2;\n        }\n        newBullet.position = pos;\n        newBullet.getComponent('Bullet').dir = this.dir.negSelf();\n        newBullet.getComponent('Bullet').owner = this;\n        newBullet.getComponent('Bullet').speed = 800;\n        this.setDir(cc.v2(-this.faceDir, 0));\n    },\n\n    onAttackFinish(nextAttackAnim) {\n        this.animationBlock = false;\n        if (nextAttackAnim) {\n            this.nextAttackAnim = nextAttackAnim;\n        } else {\n            this.nextAttackAnim = this.attackAnim;\n        }\n        if (this.running) {\n            this.run();\n        } else {\n            this.idle();\n        }\n    },\n\n    onCollisionEnter (other, self) {\n        if (other.node.group === 'scene') {\n            var selfPos = self.node.getParent().convertToWorldSpaceAR(self.node.position);\n            var otherPos = other.node.getParent().convertToWorldSpaceAR(other.node.position);\n            otherPos = otherPos.add(other.offset);\n            if (selfPos.x > otherPos.x + other.size.width / 2 ||\n                selfPos.x < otherPos.x - other.size.width / 2) {\n                this.moveAble = false;\n            } else if (selfPos.y < otherPos.y) {\n                this.vDown = 0;\n            } else {\n                this.vDown = 0;\n                this.g = 0;\n            }\n        }\n    },\n\n    onCollisionExit(other, self) {\n        if (other.node.group === 'scene') {\n            this.g = 2000;\n            this.moveAble = true;\n        }\n    },\n});"]}