{"version":3,"sources":["assets\\scripts\\enemy\\Killer.js"],"names":["cc","Class","Component","properties","vision","speed","attackLength","dir","v2","faceDir","yRange","skill_cd","player","type","Node","bulletPrefab","Prefab","onLoad","anim","node","getComponent","Animation","animState","play","wrapMode","WrapMode","Normal","Loop","repeatCount","Infinity","game","curFaceDir","onEnemyInView","enemy","pos","getParent","convertToWorldSpaceAR","position","enemyPos","sub","mag","doAttack","convertToNodeSpaceAR","setDir","onEnemyOutView","init","x","runAction","flipX","scanPlayer","isValid","playerPos","target","cd","newBullet","instantiate","group","addChild","y","width","owner","start","update","dt","len"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        vision: 0,\n        speed: 0,\n        attackLength: 0,\n        dir: cc.v2(0, 0),\n        faceDir: 1,\n        yRange: cc.v2(0, 0),\n        skill_cd: 0,\n        player: {\n            default: null,\n            type: cc.Node\n        },\n        bulletPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n    },\n\n    onLoad () {\n        var anim = this.node.getComponent(cc.Animation);\n        var animState = anim.play();\n        animState.wrapMode = cc.WrapMode.Normal;\n        animState.wrapMode = cc.WrapMode.Loop;\n        animState.repeatCount = Infinity;\n        this.game = this.node.getComponent(\"LivingObject\").game;\n        this.curFaceDir = this.faceDir;\n    },\n\n    onEnemyInView(enemy) {\n        var pos = this.node.getParent().convertToWorldSpaceAR(this.node.position);\n        var enemyPos = enemy.getParent().convertToWorldSpaceAR(enemy.position);\n        var dir = cc.v2(0, 0);\n        if (pos.sub(enemyPos).mag() < this.attackLength) {\n            this.doAttack(enemy);\n        } else {\n            enemyPos = this.node.getParent().convertToNodeSpaceAR(enemyPos);\n            dir = enemyPos.sub(this.node.position);\n        }\n        this.setDir(dir);\n    },\n\n    onEnemyOutView() {\n        this.setDir(cc.v2(0, 0));\n        this.node.getComponent(\"LivingObject\").init();\n    },\n\n    setDir(dir) {\n        this.dir = dir;\n        if (this.dir.x > 0) {\n            this.curFaceDir = 1;\n        } else if (this.dir.x < 0) {\n            this.curFaceDir = -1;\n        }\n        this.node.runAction(cc.flipX(this.curFaceDir * this.faceDir < 0));\n    },\n    \n    scanPlayer() {\n        if (this.player != null && cc.isValid(this.player)) {\n            var pos = this.node.getParent().convertToWorldSpaceAR(this.node.position);\n            var playerPos = this.player.getParent().convertToWorldSpaceAR(this.player.position);\n            if (pos.sub(playerPos).mag() < this.vision) {\n                this.onEnemyInView(this.player);\n            } else {\n                this.onEnemyOutView();\n            }\n        }\n    },\n\n    doAttack(target) {\n        if (!this.bulletPrefab) {\n            return;\n        }\n        if (this.cd > 0) {\n            return;\n        }\n        this.cd = this.skill_cd;\n        var newBullet = cc.instantiate(this.bulletPrefab);\n        newBullet.group = 'enemy';\n        this.node.getParent().addChild(newBullet, 1);\n        var pos = cc.v2(this.node.position.x, this.node.position.y);\n        pos.x = pos.x + this.curFaceDir * this.node.width / 2;\n        newBullet.position = pos;\n        newBullet.getComponent('Bullet').dir = cc.v2(this.faceDir, 0);\n        newBullet.getComponent('Bullet').owner = this;\n    },\n\n    start () {\n        if (!this.player) {\n            this.player = this.game.player;\n        }\n    },\n\n    update (dt) {\n        if (this.cd > 0) {\n            this.cd -= dt;\n        }\n        this.scanPlayer();\n        if (this.dir.mag() === 0) {\n            return;\n        }\n\n        var len = this.dir.mag();\n        this.node.x += this.dir.x / len * this.speed * dt;\n        this.node.y += this.dir.y / len * this.speed * dt;\n        if (this.node.y < this.yRange.x) {\n            this.node.y = this.yRange.x;\n        } else if (this.node.y > this.yRange.y) {\n            this.node.y = this.yRange.y;\n        }\n\n    },\n});\n"]}