{"version":3,"sources":["assets\\scripts\\defense\\Runner.js"],"names":["cc","Class","Component","properties","path","type","Array","nextPoint","speed","sleep","endPoint","v2","start","anim","node","getComponent","Animation","animState","play","wrapMode","WrapMode","Normal","Loop","repeatCount","Infinity","update","dt","length","i","j","aimPos","game","getGridPos","position","sub","mag","dir","normalizeSelf","x","y","die","destroy","updatePath","travelled","startIndex","getGridIndex","queue","Queue","push","Element","endEle","isEmpty","ele","pop","index","distance","map","hasTravelled","t","point","unshift","parent","estimate","data","element","priority","splice","toString","retstr"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        path: {\n            default: null,\n            type: Array,\n        },\n        nextPoint: 0,\n        speed: 0,\n        sleep: 1,\n        endPoint: cc.v2(7, 17),\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start () {\n        var anim = this.node.getComponent(cc.Animation);\n        var animState = anim.play();\n        animState.wrapMode = cc.WrapMode.Normal;\n        animState.wrapMode = cc.WrapMode.Loop;\n        animState.repeatCount = Infinity;\n    },\n\n    update (dt) {\n        if (this.sleep > 0) {\n            this.sleep -= dt;\n            return;\n        }\n        if (!this.path) {\n            return;\n        }\n        if (this.nextPoint >= this.path.length) {\n            return;\n        }\n        var i = this.path[this.nextPoint][0];\n        var j = this.path[this.nextPoint][1];\n        var aimPos = this.game.getGridPos(i, j);\n        if (this.node.position.sub(aimPos).mag() < 10) {\n            this.nextPoint++;\n            return;\n        }\n        var dir = aimPos.sub(this.node.position).normalizeSelf();\n        this.node.x += dir.x * this.speed * dt;\n        this.node.y += dir.y * this.speed * dt;\n    },\n\n    die() {\n        this.node.destroy();\n    },\n\n    updatePath() {\n        var travelled = new Array();\n        var startIndex = this.game.getGridIndex(this.node.position);\n        var queue = new Queue();\n        queue.push(new Element(startIndex, 0, 0, null));\n        travelled.push(startIndex);\n        var endEle = null;\n        while(!queue.isEmpty()) {\n            var ele = queue.pop();\n            if (ele.index.x === this.endPoint.x && ele.index.y === this.endPoint.y) {\n                endEle = ele;\n                break;\n            }\n            for (var i = -1; i <= 1; ++i) {\n                for (var j = -1; j <= 1; ++j) {\n                    if (i * i + j * j === 2) {\n                        continue;\n                    }\n                    var distance = cc.v2(i, j).mag() + ele.distance;\n                    var index = cc.v2(ele.index.x + i, ele.index.y + j);\n                    if (index.x < 0 || index.x > 7 || index.y < 0 || index.y > 17) {\n                        continue;\n                    }\n                    if (this.game.map[index.x][index.y] != 0) {\n                        continue;\n                    }\n                    var hasTravelled = false;\n                    for (var t = 0; t < travelled.length; t++) {\n                        if (travelled[t].x === index.x && travelled[t].y === index.y) {\n                            hasTravelled = true;\n                            break;\n                        }\n                    }\n                    if (!hasTravelled) {\n                        queue.push(new Element(index, this.endPoint.sub(index).mag() + distance, distance, ele));\n                        travelled.push(index);\n                    }\n                }\n            }\n        }\n        if (endEle) {\n            var path = new Array();\n            while (endEle) {\n                var point = new Array();\n                point.push(endEle.index.x);\n                point.push(endEle.index.y);\n                path.unshift(point);\n                endEle = endEle.parent;\n            }\n            this.path = path;\n            this.nextPoint = 0;\n        }\n    },\n\n});\n\nfunction Element(index, estimate, distance, parent){\n    this.index = index;\n    this.estimate = estimate;\n    this.distance = distance;\n    this.parent = parent;\n}\n\nfunction Queue() {\n    this.data = [];\n    this.push = function (element) {\n        this.data.push(element);\n    };\n    this.pop = function () {\n        var priority = 0;\n        for (var i = 0; i < this.data.length; ++i) {\n            if (this.data[i].distance < this.data[priority].distance) {\n                priority = i;\n            }\n        }\n        var ele = this.data[priority];\n        this.data.splice(priority, 1);\n        return ele;\n    };\n    this.isEmpty = function() {\n        return this.data.length === 0;\n\n    };\n    this.toString = function () {\n        var retstr = '';\n        for (var i = 0; i < this.data.length; ++i) {\n            retstr += this.data[i].index + \" distance: \" + this.data[i].distance + \"\\n\";\n        }\n        return retstr;\n    }\n};"]}