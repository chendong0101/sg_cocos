{"version":3,"sources":["assets\\scripts\\rpg\\Pet.js"],"names":["cc","Class","Component","properties","vision","speed","followLength","dir","v2","faceDir","mountPoint","yRange","player","type","Node","inTask","taskStar","onLoad","originFaceDir","anim","node","getComponent","Animation","animState","play","wrapMode","WrapMode","Normal","Loop","repeatCount","Infinity","onCollisionEnter","other","self","name","onPicked","setDir","x","runAction","flipX","followOwner","pos","getParent","convertToWorldSpaceAR","position","playerPos","realMountPoint","add","sub","mag","convertToNodeSpaceAR","scanStar","isValid","star","scene","getChildByName","starPos","onStarInView","start","game","update","dt","len","y"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        vision: 0,\n        speed: 0,\n        followLength: 0,\n        dir: cc.v2(0, 0),\n        faceDir: -1,\n        mountPoint: cc.v2(-50, 50),\n        yRange: cc.v2(0, 0),\n        player: {\n            default: null,\n            type: cc.Node\n        },\n        inTask: false,\n        taskStar: {\n            default: null,\n            type: cc.Node\n        },\n    },\n\n    onLoad () {\n        this.originFaceDir = this.faceDir;\n        var anim = this.node.getComponent(cc.Animation);\n        var animState = anim.play();\n        animState.wrapMode = cc.WrapMode.Normal;\n        animState.wrapMode = cc.WrapMode.Loop;\n        animState.repeatCount = Infinity;\n    },\n\n    onCollisionEnter (other, self) {\n        if (other.node.name === 'star') {\n            other.node.getComponent(\"Star\").onPicked();\n        }\n        this.inTask = false;\n    },\n\n    setDir(dir) {\n        this.dir = dir;\n        if (this.dir.x > 0) {\n            this.faceDir = 1;\n        } else if (this.dir.x < 0) {\n            this.faceDir = -1;\n        } else {\n            this.faceDir = this.player.getComponent(\"RPGPlayer\").faceDir;\n        }\n        this.node.runAction(cc.flipX((this.originFaceDir * this.faceDir) < 0));\n    },\n    \n    followOwner() {\n        if (this.inTask) {\n            return;\n        }\n        if (this.player != null) {\n            var pos = this.node.getParent().convertToWorldSpaceAR(this.node.position);\n            var playerPos = this.player.getParent().convertToWorldSpaceAR(this.player.position);\n            var realMountPoint = cc.v2(this.mountPoint);\n            if (this.player.getComponent(\"RPGPlayer\").faceDir < 0) {\n                realMountPoint.x = -this.mountPoint.x;\n            }\n             //cc.log(this.player.getComponent(\"RPGPlayer\").faceDir);\n             //cc.log(this.mountPoint.x);\n             //cc.log(realMountPoint.x);\n            playerPos = realMountPoint.add(playerPos);\n            if (pos.sub(playerPos).mag() > this.followLength) {\n                playerPos = this.node.getParent().convertToNodeSpaceAR(playerPos);\n                var dir = playerPos.sub(this.node.position);\n                this.setDir(dir);\n            } else {\n                this.setDir(cc.v2(0, 0));\n            }\n        }\n    },\n\n    scanStar() {\n        if (this.inTask && this.taskStar.isValid) {\n            return;\n        }\n        this.inTask = false;\n        var star = this.scene.getChildByName(\"star\");\n        if (!star) {\n            return;\n        }\n        var pos = this.node.getParent().convertToWorldSpaceAR(this.node.position);\n        var starPos = star.getParent().convertToWorldSpaceAR(star.position);\n        if (pos.sub(starPos).mag() < this.vision) {\n            this.onStarInView(star);\n        }\n    },\n\n    onStarInView(star) {\n        var pos = this.node.getParent().convertToWorldSpaceAR(this.node.position);\n        var starPos = star.getParent().convertToWorldSpaceAR(star.position);\n        var dir = cc.v2(0, 0);\n        if (pos.sub(starPos).mag() > 0) {\n            starPos = this.node.getParent().convertToNodeSpaceAR(starPos);\n            dir = starPos.sub(this.node.position);\n        }\n        this.setDir(dir);\n        this.inTask = true;\n        this.taskStar = star;\n    },\n\n    start () {\n        if (!this.player) {\n            this.player = this.game.player;\n        }\n        if (!this.scene) {\n            this.scene = this.game.scene;\n        }\n    },\n\n    update (dt) {\n        this.scanStar();\n        this.followOwner();\n        if (this.dir.mag() === 0) {\n            return;\n        }\n\n        var len = this.dir.mag();\n        this.node.x += this.dir.x / len * this.speed * dt;\n        this.node.y += this.dir.y / len * this.speed * dt;\n        if (this.node.y < this.yRange.x) {\n            this.node.y = this.yRange.x;\n        } else if (this.node.y > this.yRange.y) {\n            this.node.y = this.yRange.y;\n        }\n    },\n\n});\n"]}