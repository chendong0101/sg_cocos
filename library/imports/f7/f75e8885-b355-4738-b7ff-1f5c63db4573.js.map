{"version":3,"sources":["assets\\scripts\\defense\\Defent-Game.js"],"names":["cc","Class","Component","properties","map","type","Array","wallPrefab","Prefab","monsterPrefab","towerPrefab","scene","Node","waveCD","waveLable","Label","resultUIPrefab","onLoad","monsters","walls","mapWidth","width","mapHeight","height","manager","director","getCollisionManager","enabled","cd","wave","i","j","wall","instantiate","addChild","position","getGridPos","push","tower","getComponent","game","active","node","walk","target","name","convertToNodeSpaceAR","convertToWorldSpaceAR","city","getChildByName","start","update","dt","isValid","onGameFailed","length","onGameSuccess","newWave","string","Math","floor","ui","destroy","path","monster","group","setContentSize","removeComponent","addComponent","speed","sleep","updatePath","retreatLength","blood","updateBloodBar","updateMonsterPath","v2","getGridIndex","pos","x","y"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        map: {\n            default: [],\n            type: Array,\n        },\n        wallPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        monsterPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        towerPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        scene: {\n            default: null,\n            type: cc.Node\n        },\n        waveCD: 0,\n        waveLable: {\n            default: null,\n            type: cc.Label\n        },\n        resultUIPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n    },\n\n    onLoad () {\n        this.monsters = new Array();\n        this.walls = new Array();\n        this.mapWidth = this.scene.width;\n        this.mapHeight = this.scene.height;\n        var manager = cc.director.getCollisionManager();\n        manager.enabled = true;\n        this.cd = this.waveCD;\n        this.wave = 0;\n        this.map = [\n                [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0],\n                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],\n                [0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],\n                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],\n                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n        ];\n        for (var i = 0; i < 8; i ++) {\n            for (var j = 0; j < 15; j++) {\n                if (this.map[i][j] >= 1) {\n                    var wall = cc.instantiate(this.wallPrefab);\n                    this.scene.addChild(wall, 1);\n                    wall.position = this.getGridPos(i, j);\n                    this.walls.push(wall);\n                }\n                if (this.map[i][j] > 1) {\n                    var tower  = cc.instantiate(this.towerPrefab);\n                    this.scene.addChild(tower, 1);\n                    tower.position = this.getGridPos(i, j);\n                    tower.getComponent(\"Tower\").game = this;\n                    tower.getComponent(\"Tower\").active = true;\n                }\n            }\n        }\n\n        this.node.walk((target) => {\n            if (target.name === \"bench\") {\n                var tower = cc.instantiate(this.towerPrefab);\n                this.scene.addChild(tower, 1);\n                tower.position = this.scene.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(target.position));\n                tower.getComponent(\"Tower\").game = this;\n            }\n            if (target.name === \"obstacle\") {\n                target.getComponent(\"Obstacle\").game = this;\n            }\n        }, \n        (target) => {});\n\n        this.city = this.scene.getChildByName(\"city\");\n    },\n\n    start () {\n\n    },\n\n    update (dt) {\n        if (!this.city || !this.city.isValid) {\n            this.onGameFailed();\n            return;\n        }\n        if (this.wave > 2) {\n            for (var i = 0; i < this.monsters.length; ++i) {\n                if (this.monsters[i].isValid) {\n                    return;\n                }\n            }\n            this.onGameSuccess();\n        }\n        if (this.cd <= 0) {\n            this.newWave();\n            this.cd = this.waveCD;\n        }\n        this.cd -= dt;\n        this.waveLable.string = '下一波进攻还有: ' + Math.floor(this.cd) + \" 秒\";\n    },\n\n    onGameSuccess () {\n        var ui = cc.instantiate(this.resultUIPrefab);\n        this.node.addChild(ui, 0);\n    },\n\n    onGameFailed () {\n        var ui = cc.instantiate(this.resultUIPrefab);\n        this.node.addChild(ui, 0);\n        for (var i = 0; i < this.monsters.length; ++i) {\n            if (this.monsters[i].isValid) {\n                this.monsters[i].destroy();\n            }\n        }\n    },\n\n    newWave() {\n        var path = [[0,0], [1,0], [2,0], [3,0], [4,0], [5,1], [5,2],[5,3],[5,4],[6,5],[7,6]\n                ,[7,7],[7,8],[6,8],[5,8],[4,8],[3,9],[2,10],[2,11],[2,12],[3,1],[4,13],[5,14],[6,15],[6,16]];\n        for (var i = 0; i < 5 + this.wave * 1.5; i++) {\n            var monster = cc.instantiate(this.monsterPrefab);\n            this.scene.addChild(monster, 1);\n            monster.group = \"enemy\";\n            monster.position = this.getGridPos(0, 0);\n            monster.setContentSize(64, 64);\n            monster.removeComponent(\"Killer\");\n            monster.addComponent(\"Runner\");\n            monster.getComponent(\"Runner\").speed = 100 + this.wave * 10;\n            monster.getComponent(\"Runner\").sleep = i;\n            monster.getComponent(\"Runner\").game = this;\n            monster.getComponent(\"Runner\").updatePath();\n            monster.getComponent(\"LivingObject\").retreatLength = 0;\n            monster.getComponent(\"LivingObject\").blood += this.wave * 5;\n            monster.getComponent(\"LivingObject\").updateBloodBar();\n            this.monsters.push(monster);\n        }\n        this.wave++;\n    },\n\n    updateMonsterPath() {\n        for (var i = 0; i < this.monsters.length; ++i) {\n            if (this.monsters[i].isValid) {\n                this.monsters[i].getComponent(\"Runner\").updatePath();\n            }\n        }\n    },\n\n    getGridPos(i, j) {\n        return cc.v2(j * 64 - this.mapWidth / 2 + 32, this.mapHeight / 2 - i * 64 - 32);\n    },\n\n    getGridIndex(pos) {\n        var j = (pos.x + this.mapWidth / 2) / 64 | 0;\n        var i = (this.mapHeight / 2 - pos.y) / 64 | 0;\n        return cc.v2(i, j);\n    },\n});\n"]}