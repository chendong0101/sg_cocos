{"version":3,"sources":["assets\\scripts\\LivingObject.js"],"names":["cc","Class","Component","properties","retreatLength","beAttackedAudio","type","AudioClip","starCount","bloodBarPrefab","Prefab","isBoss","blood","onBeAttacked","bullet","other","reTreatLength","otherPos","node","getParent","convertToWorldSpaceAR","position","thisPos","x","retreat","moveBy","v2","easing","easeCubicActionOut","runAction","updateBlood","getComponent","power","die","destroy","game","spawnNewStar","onLivingObjectDead","i","bloodLeft","bloodBar","getChildByName","width","onLoad","instantiate","addChild","updateBloodBar","init","height","start"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        retreatLength: 0,\n        beAttackedAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n        starCount: 1,\n        bloodBarPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        isBoss: false,\n        blood: 0,\n    },\n\n    // onCollisionEnter (other, self) {\n    //     // console.log(other.node.name);\n    // },\n\n    onBeAttacked(bullet, other) {\n        if (this.retreatLength > 0) {\n            var reTreatLength = this.retreatLength;\n            var otherPos = other.node.getParent().convertToWorldSpaceAR(other.node.position);\n            var thisPos = this.node.getParent().convertToWorldSpaceAR(this.node.position);\n            if (otherPos.x - thisPos.x > 0) {\n                reTreatLength = -this.retreatLength;\n            }\n            var retreat = cc.moveBy(0.1, cc.v2(reTreatLength, 0)).easing(cc.easeCubicActionOut());\n            this.node.runAction(retreat);\n            // cc.audioEngine.playEffect(this.beAttackedAudio, false);\n        }\n        this.updateBlood(-bullet.getComponent(\"Bullet\").power);\n    },\n\n    die () {\n        this.node.destroy();\n        if (this.game) {\n            this.game.spawnNewStar(this.node.position, this.starCount);\n            this.game.onLivingObjectDead(this.isBoss);\n            //this.game.spawnNewMonster();\n        }\n    },\n\n    updateBlood (i) {\n        this.bloodLeft += i;\n        if (this.bloodLeft < 0) {\n            this.bloodLeft = 0;\n        }\n        this.bloodBar.getChildByName(\"blood\").width = this.bloodLeft * this.bloodBar.width / this.blood;\n        if (this.bloodLeft === 0) {\n            this.die();\n        }\n    },\n\n    onLoad () {\n        this.bloodBar = cc.instantiate(this.bloodBarPrefab);\n        this.node.addChild(this.bloodBar, 0);\n        this.updateBloodBar();\n        this.init();\n    },\n\n    updateBloodBar() {\n        this.bloodBar.position = cc.v2(0, this.node.height / 2 + 10);\n        var width = this.node.width;\n        this.bloodBar.width = width;\n        this.bloodBar.getChildByName(\"blood\").width = width;\n        this.bloodBar.getChildByName(\"blood\").position = cc.v2(-width / 2, 0);\n    },\n\n    init() {\n        this.bloodLeft = this.blood;\n    },\n\n    start () {\n\n    },\n\n    // update (dt) {},\n});\n"]}