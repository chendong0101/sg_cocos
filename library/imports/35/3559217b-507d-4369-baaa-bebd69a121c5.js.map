{"version":3,"sources":["assets\\scripts\\rpg\\RPGGame.js"],"names":["cc","Class","Component","properties","starPrefab","type","Prefab","monsterPrefab","groundHeight","scene","Node","playerPrefab","petPrefab","controllerPrefab","scoreDisplay","Label","scoreAudio","AudioClip","resultUIPrefab","totalTime","onLoad","manager","director","getCollisionManager","enabled","score","children","i","length","getComponent","game","initScoreDisplayLable","initPlayer","initPet","initController","player","instantiate","node","addChild","name","pet","mountPoint","pos","getParent","convertToWorldSpaceAR","position","add","convertToNodeSpaceAR","controller","spawnNewMonster","newMonster","getNewMonsterPosition","setPosition","spawnNewStar","count","step","Math","PI","newStar","starPos","v2","x","sin","y","cos","addScore","string","audioEngine","playEffect","onGameSuccess","randX","randY","random","jumpHeight","maxX","width","onLivingObjectDead","isBoss","onGameEnd","destroy","ui","onGameFailed","onGameStart","loadScene","onStart"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        starPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        monsterPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        groundHeight: 0, \n        scene: {\n            default: null,\n            type: cc.Node\n        },\n        playerPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        petPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        controllerPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        scoreDisplay: {\n            default: null,\n            type: cc.Label\n        },\n        scoreAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n        resultUIPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        totalTime: 0,\n    },\n\n    onLoad () {\n        var manager = cc.director.getCollisionManager();\n        manager.enabled = true;\n        //manager.enabledDebugDraw = true;\n        //manager.enabledDrawBoundingBox = true;\n        this.score = 0;\n        var children = this.scene.children;\n        for (var i = 0; i < children.length; ++i) {\n            if (children[i].getComponent(\"LivingObject\")) {\n                children[i].getComponent(\"LivingObject\").game = this;\n            }\n        }\n\n        this.initScoreDisplayLable();\n        this.initPlayer();\n        this.initPet();\n        this.initController();\n    },\n\n    initScoreDisplayLable() {\n        // this.scoreDisplay = cc.instantiate(this.scorePrefab);\n        // this.node.addChild(this.scoreDisplay, 2);\n    },\n\n    initPlayer () {\n        this.player = cc.instantiate(this.playerPrefab);\n        this.node.addChild(this.player, 1);\n        this.player.name = \"player\";\n        this.player.getComponent(\"RPGPlayer\").scene = this.scene;\n        this.player.getComponent(\"RPGPlayer\").game = this;\n        this.player.getComponent(\"LivingObject\").game = this;\n    },\n\n    initPet () {\n        this.pet = cc.instantiate(this.petPrefab);\n        this.scene.addChild(this.pet, 1);\n        var mountPoint = this.pet.getComponent(\"Pet\").mountPoint;\n        var pos = this.player.getParent().convertToWorldSpaceAR(this.player.position);\n        pos = pos.add(mountPoint);\n        this.pet.position = this.scene.convertToNodeSpaceAR(pos);\n        this.pet.getComponent(\"Pet\").scene = this.scene;\n        this.pet.getComponent(\"Pet\").player = this.player;\n    },\n\n    initController () {\n        this.controller = cc.instantiate(this.controllerPrefab);\n        this.node.addChild(this.controller, 2);\n        var children = this.controller.children;\n        for (var i = 0; i < children.length; ++i) {\n            if (children[i].getComponent(\"Controller\")) {\n                children[i].getComponent(\"Controller\").player = this.player;\n            }\n        }\n    },\n\n    spawnNewMonster () {\n        var newMonster = cc.instantiate(this.monsterPrefab);\n        newMonster.getComponent('LivingObject').game = this;\n        this.scene.addChild(newMonster, 1);\n        var pos = this.getNewMonsterPosition();\n        newMonster.setPosition(pos);\n    },\n\n    spawnNewStar(pos, count) {\n        var step = 2 * Math.PI / count;\n        for (var i = 0; i < count; i++) {\n            var newStar = cc.instantiate(this.starPrefab);\n            this.scene.addChild(newStar, 1);\n            var starPos = cc.v2(pos.x + 90 * Math.sin(i * step), pos.y + 90 * Math.cos(i * step));\n            newStar.setPosition(starPos);\n            newStar.getComponent('Star').game = this;\n        }\n    },\n\n    addScore(i) {\n        if (this.score === 100) {\n            return;\n        }\n        this.score = i + this.score;\n        this.scoreDisplay.string = 'Score: ' + this.score;\n        cc.audioEngine.playEffect(this.scoreAudio, false);\n        if (this.score === 100) {\n            this.onGameSuccess();\n        }\n    },\n\n    getNewMonsterPosition () {\n        var randX = 0;\n        var randY = this.groundHeight + Math.random() * 0.6 * this.player.getComponent('RPGPlayer').jumpHeight + 100; \n        var maxX = this.scene.width / 2 - 20;\n        randX = (Math.random() - 0.5) * 2 * maxX;\n        return cc.v2(randX, randY);\n    },\n\n    onLivingObjectDead(isBoss) {\n        if (isBoss) {\n            this.onGameSuccess();\n        }\n    },\n\n    onGameEnd() {\n        this.player.destroy();\n        this.scoreDisplay.destroy();\n    },\n\n    onGameSuccess () {\n        this.onGameEnd();\n        var ui = cc.instantiate(this.resultUIPrefab);\n        this.node.addChild(ui, 0);\n    },\n\n    onGameFailed () {\n        this.onGameEnd();\n        var ui = cc.instantiate(this.resultUIPrefab);\n        this.node.addChild(ui, 0);\n    },\n    \n    onGameStart: function() {\n        cc.director.loadScene('game');\n        this.player.onStart();\n    },\n\n//    update (dt) {\n//        if (this.totalTime < 0) {\n//            this.onGameEnd();\n//            return;\n//        }\n//        this.totalTime -= dt;\n//    },\n});\n"]}